<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Before you start · Wellcome ECA Remit Checker (Prototype)</title>

  <!-- Inter font; page will gracefully fall back if blocked -->
  https://fonts.googleapis.com
  https://fonts.gstatic.com
  https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap

  <style>
    /* === Minimal, robust CSS (no dependencies) === */
    :root{
      --bg:#ffffff; --ink:#111111; --muted:#4b5563; --link:#0b5cab;
      --border:#e5e7eb; --focus:#1d4ed8;
      --warn:#b45309; --good:#0f9960;
      --max:720px; --radius:10px; --gap:16px;
      --yellow:#fff6b5; --yellow-border:#f2e48a;
    }
    *, *::before, *::after { box-sizing:border-box }
    html, body { height:100% }
    body {
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--ink); background:var(--bg);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    a { color:var(--link) }
    .wrap { max-width:var(--max); margin:0 auto; padding:0 16px }
    header { padding:32px 0 20px; border-bottom:1px solid var(--border) }
    h1 { font-size:32px; line-height:1.2; margin:0 0 8px; font-weight:700; letter-spacing:-0.01em }
    .lede { margin:0; color:var(--muted); font-size:16px }

    main { padding:24px 0 }
    .block { display:block }
    .label { font-weight:600; margin-bottom:8px }

    textarea, select, input[type="number"] {
      width:100%; border:1px solid var(--border); border-radius:var(--radius);
      padding:12px 14px; font:inherit; color:inherit; background:#fff;
    }
    textarea { min-height:230px; resize:vertical }
    textarea:focus, select:focus, input:focus {
      outline:3px solid rgba(29,78,216,.25);
      border-color:var(--focus);
    }

    fieldset { border:1px solid var(--border); border-radius:var(--radius); padding:12px; margin-top:var(--gap) }
    legend { padding:0 6px; color:var(--muted); font-size:14px }
    .grid { display:grid; gap:12px; grid-template-columns:repeat(2,minmax(0,1fr)) }
    @media (max-width:760px){ .grid{ grid-template-columns:1fr } }
    .details summary { cursor:pointer; color:var(--muted) }

    .actions { display:flex; gap:10px; margin-top:16px; flex-wrap:wrap }
    .btn {
      appearance:none; border:1px solid #111; background:#111; color:#fff;
      border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer;
    }
    .btn[disabled] { opacity:.6; cursor:wait }
    .btn.ghost { background:#fff; border:1px solid var(--border); color:var(--muted) }

    .guidance {
      margin-top:24px; background:var(--yellow); border:1px solid var(--yellow-border);
      border-radius:var(--radius); padding:16px;
    }
    .guidance h2{ margin:0 0 8px; font-size:18px }
    .guidance p{ margin:0 0 8px; color:#1f2937 }
    .links{ margin:8px 0 0; padding-left:18px }
    .links li{ margin:4px 0 }

    #results { margin-top:28px }
    #results h2 { margin:0 0 10px; font-size:22px }
    .scorecards { display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:12px }
    @media (max-width:760px){ .scorecards{ grid-template-columns:1fr } }
    .scorecard { border:1px solid var(--border); border-radius:var(--radius); padding:12px; background:#fff }
    .scorecard h3 { margin:0 0 8px }
    .score { font-weight:700; font-size:30px }

    .stack { display:flex; flex-direction:column; gap:8px }
    .bar { display:flex; align-items:center; gap:12px }
    progress { width:100%; height:10px }
    .cols { display:grid; gap:12px; grid-template-columns:1fr 1fr; margin-top:12px }
    @media (max-width:760px){ .cols{ grid-template-columns:1fr } }
    .panel { border:1px solid var(--border); border-radius:var(--radius); padding:12px; background:#fff }
    .risks li { color:var(--warn) }
    .reasons, ul, ol { margin:8px 0 0; padding-left:18px }
    footer { border-top:1px solid var(--border); margin-top:28px; padding:14px 0 }
    .tiny { font-size:12px; color:var(--muted) }
    .hidden { display:none }

    #toast{
      position:fixed;left:50%;top:18px;transform:translateX(-50%);
      background:#111;color:#fff;padding:10px 14px;border-radius:10px;z-index:9999;
      font-weight:600;box-shadow:0 6px 20px rgba(0,0,0,.2);display:none
    }
    .badge{
      display:inline-block;margin-left:8px;padding:3px 8px;font-size:12px;
      border:1px solid var(--border);border-radius:999px;color:#374151;background:#fafafa
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Before you start <span id="rulesBadge" class="badge">Ruleset loading…</span></h1>
      <p class="lede">
        Paste your proposal summary to check <strong>eligibility</strong> and <strong>Discovery Research remit</strong> fit for the Wellcome Early‑Career Award.
        This is a design prototype; results are heuristic, not a funding decision.
      </p>
    </div>
  </header>

  <main class="wrap">
    <!-- Form -->
    <form id="checkerForm" novalidate>
      <label class="block">
        <div class="label">Enter your proposal summary</div>
        <textarea id="summary" placeholder="Paste or type ~500–1,500 words describing aims, rationale, methods, expected knowledge gains, and key risks…"></textarea>
      </label>

      <fieldset>
        <legend>Quick eligibility & remit checklist</legend>
        <div class="grid">
          <label class="block">
            <div class="label">Career training</div>
            <select id="training">
              <option value="unknown" selected>Select…</option>
              <option value="phd">Completed PhD / higher research degree</option>
              <option value="equiv">No PhD, but ≥4 years’ equivalent research experience</option>
              <option value="none">Neither of the above</option>
            </select>
          </label>

          <label class="block">
            <div class="label">Postdoctoral experience (years)</div>
            <input type="number" id="postdocYears" min="0" step="0.1" placeholder="e.g., 1.5" />
          </label>

          <label class="block">
            <div class="label">Time on project (%)</div>
            <input type="number" id="timePct" min="0" max="100" step="1" placeholder="e.g., 80" />
          </label>

          <label class="block">
            <div class="label">Administering organisation</div>
            <select id="orgLoc">
              <option value="unknown" selected>Select…</option>
              <option value="uk">UK</option>
              <option value="roi">Republic of Ireland</option>
              <option value="lmics">Low-/middle‑income country</option>
              <option value="india">India (not eligible)</option>
              <option value="china">Mainland China (not eligible)</option>
              <option value="other">Other</option>
            </select>
          </label>

          <label class="block">
            <div class="label">Co‑applicants (ECA)</div>
            <select id="coapplicants">
              <option value="unknown" selected>Select…</option>
              <option value="no">No (lead applicant only)</option>
              <option value="yes">Yes (co‑applicants listed)</option>
            </select>
          </label>
        </div>

        <details class="details" style="margin-top:8px">
          <summary>Potential out‑of‑remit signals</summary>
          <div class="grid" style="margin-top:8px">
            <label class="block">
              <div class="label">Main aim is to test if an intervention works (e.g., large RCT)</div>
              <select id="trialFocus"><option>No</option><option>Yes</option></select>
            </label>
            <label class="block">
              <div class="label">Primary goal is diagnostic/treatment for clinical care</div>
              <select id="diagnosticFocus"><option>No</option><option>Yes</option></select>
            </label>
            <label class="block">
              <div class="label">Animal disease not relevant to humans</div>
              <select id="animalOut"><option>No</option><option>Yes</option></select>
            </label>
            <label class="block">
              <div class="label">Stand‑alone database/resource without research questions</div>
              <select id="standalone"><option>No</option><option>Yes</option></select>
            </label>
          </div>
        </details>
      </fieldset>

      <div class="actions">
        <button type="button" id="analyzeBtn" class="btn">Submit proposal summary</button>
        <button type="button" id="exportBtn" class="btn ghost">Export report (PDF)</button>
        <button type="button" id="resetBtn" class="btn ghost">Reset</button>
      </div>
    </form>

    <!-- Yellow guidance panel -->
    <section class="guidance" aria-labelledby="how-it-works">
      <h2 id="how-it-works">How Wellcome grant funding works</h2>
      <p>Use these links to check scope, eligibility and conditions before you complete a full application.</p>
      <ul class="links">
        <li><a target="_blank" rel="noreferrer" href="https://wellcome.org/research-funding">Discovery Research remit (what we fund)</a></li>
        <li><a target="_blank" rel="noreferrer" href="https://wellcome.org/research-funding/schemes/wellcome-early-career-awards">Early‑Career Award (scheme page)</a></li>
        <li><a target="_blank" rel="noreferrer" href="https://wellcome.org/research-funding">Grant conditions & policies</a></li>
        <li><a target="_blank" rel="noreferrer" href="https://wellcome.org/research-funding/guidance/prepare-to-apply/early-care></li>
      </ul>
      <p><strong>Need help?</strong> Contact Wellcome Funding Information Advisers via the “Contact us” links on the pages above.</p>
    </section>

    <!-- Results -->
    <section id="results" class="hidden" aria-live="polite">
      <h2>Results</h2>
      <div class="scorecards">
        <div class="scorecard">
          <h3>Eligibility</h3>
          <div class="score" id="eligScore">–</div>
          <ul id="eligReasons" class="reasons"></ul>
        </div>
        <div class="scorecard">
          <h3>Remit fit</h3>
          <div class="score" id="remitScore">–</div>
          <ul id="remitReasons" class="reasons"></ul>
        </div>
        <div class="scorecard">
          <h3>Assessment (50/25/25)</h3>
          <div class="stack">
            <div class="bar"><span>Proposal (50%)</span><progress id="propProg" max="100" value="0"></progress></div>
            <div class="bar"><span>Skills & experience (25%)</span><progress id="skillsProg" max="100" value="0"></progress></div>
            <div class="bar"><span>Research environment (25%)</span><progress id="envProg" max="100" value="0"></progress></div>
          </div>
          <ul id="assessNotes" class="reasons"></ul>
        </div>
      </div>

      <div class="cols">
        <div class="panel">
          <h3>Strengths</h3>
          <ul id="strengths"></ul>
        </div>
        <div class="panel">
          <h3>Risks</h3>
          <ul id="risks" class="risks"></ul>
        </div>
      </div>

      <div class="panel" style="margin-top:12px">
        <h3>Suggestions to tighten your summary</h3>
        <ol id="suggestions"></ol>
      </div>
    </section>
  </main>

  <footer>
    <div class="wrap tiny">
      <p>Prototype for product exploration. Rules summarised from Wellcome ECA & Discovery Research pages; not official guidance. No data leaves your browser.</p>
    </div>
  </footer>

  <div id="toast" role="status" aria-live="polite"></div>

  <!-- === Baked-in rules (derived from PDFs you provided) === -->
  <script>
    const RULES = {
      version: "Wellcome ECA · 2025-10",
      eligibility: {
        training: { needOneOf: ["phd","equiv"], weightFail: 50, note: "PhD or ≥4 years’ equivalent research experience" },
        minTimePct: { value: 80, weightFail: 25, note: "≥80% research time" },
        coApplicants: { accepted:false, weightFail: 25, note: "Co‑applicants not accepted (collaborators OK)" },
        admin: { allow:["uk","roi","lmics"], ban:["india","china"], weightFail:100, note:"Admin org must be UK/ROI/LMICs; not India or mainland China" },
        transferBanChina: { active:true, weightFail:100, note:"Cannot transfer Wellcome grant funds into mainland China" },
        maxPostdocYears: { value:3, weightCaution:10, note:">3y postdoc needs context (breaks, part‑time, discipline change)" }
      },
      remit: {
        base: 80,
        positives: [
          { p:"mechanism", w:+5 },{ p:"causal", w:+4 },{ p:"pathophysiology", w:+4 },
          { p:"fundamental", w:+3 },{ p:"novel method", w:+3 },{ p:"conceptual framework", w:+3 },
          { p:"tool", w:+2 },{ p:"theoretical", w:+2 },{ p:"insight", w:+2 },
          { p:"understanding", w:+3 },{ p:"hypothesis", w:+2 },{ p:"exploratory", w:+2 },
          { p:"needs of communities", w:+2 },{ p:"social context", w:+2 },{ p:"historical context", w:+2 },{ p:"ethical context", w:+2 }
        ],
        negatives: [
          // Trials / efficacy
          { n:"randomized", w:-15, why:"large trial/efficacy focus" },
          { n:"randomised", w:-15, why:"large trial/efficacy focus" },
          { n:"phase ii", w:-15 },{ n:"phase iii", w:-15 },{ n:"multicentre trial", w:-12 },
          // Diagnostic/clinical service focus
          { n:"clinical decision support", w:-12 },{ n:"diagnostic", w:-12 },{ n:"screening", w:-10 },
          // Resources without questions
          { n:"standalone database", w:-10 },{ n:"stand-alone database", w:-10 },{ n:"registry", w:-8 },{ n:"repository", w:-8 },
          // Animal not human-relevant
          { n:"veterinary-only", w:-15 },{ n:"animal disease not relevant to humans", w:-15 }
        ]
      }
    };
  </script>

  <!-- === Analysis logic (stable) === -->
  <script>
    const $ = id => document.getElementById(id);
    const analyzeBtn = $('analyzeBtn'), exportBtn = $('exportBtn'), resetBtn = $('resetBtn'), results = $('results');

    // badge
    const badge = $('rulesBadge');
    if (badge) badge.textContent = `Ruleset: ${RULES.version}`;

    analyzeBtn.addEventListener('click', runAnalysis);
    exportBtn.addEventListener('click', () => window.print());
    resetBtn.addEventListener('click', () => { $('checkerForm').reset(); results.classList.add('hidden'); });

    function runAnalysis(){
      const summary = $('summary').value.trim();
      if (!summary) { $('summary').focus(); toast('Please paste a short proposal summary first.'); return; }

      const prev = analyzeBtn.textContent;
      analyzeBtn.disabled = true; analyzeBtn.textContent = 'Analysing…';

      try {
        // Read inputs
        const training = $('training').value;
        const postdocYears = parseMaybeFloat($('postdocYears').value);
        const timePct = parseMaybeFloat($('timePct').value);
        const orgLoc = $('orgLoc').value;
        const coapps = $('coapplicants').value;

        const s = summary;
        const inferred = inferFromText(s);

        // === Eligibility
        let elig = 100; const eNotes = []; const need = [];

        // Training
        if (training === 'unknown'){
          need.push('Career training');
        } else if (training === 'none'){
          elig -= RULES.eligibility.training.weightFail;
          eNotes.push('Needs PhD or ≥4 years’ equivalent research experience.');
        }

        // Postdoc
        if (!isFinite(postdocYears)){
          if (inferred.postdocOver3) { elig -= RULES.eligibility.maxPostdocYears.weightCaution; eNotes.push('Text suggests >3y postdoc – add context.'); }
          else need.push('Postdoctoral experience (years)');
        } else if (postdocYears > RULES.eligibility.maxPostdocYears.value){
          elig -= RULES.eligibility.maxPostdocYears.weightCaution;
          eNotes.push('>3y postdoc – add context (breaks, part‑time, discipline change).');
        }

        // Time commitment
        if (!isFinite(timePct)){
          if (inferred.timeUnder80) { elig -= RULES.eligibility.minTimePct.weightFail; eNotes.push('Text implies <80% time — ECA expects ≥80%.'); }
          else need.push('Time on project (%)');
        } else if (timePct < RULES.eligibility.minTimePct.value){
          elig -= RULES.eligibility.minTimePct.weightFail;
          eNotes.push('Commit at least 80% research time (≤20% other duties).');
        }

        // Admin org location
        const allow = RULES.eligibility.admin.allow, ban = RULES.eligibility.admin.ban;
        if (orgLoc === 'unknown'){
          need.push('Administering organisation');
          if (inferred.adminIndia){ elig -= RULES.eligibility.admin.weightFail; eNotes.push('Admin org appears in India — ineligible.'); }
          if (inferred.adminChina){ elig -= RULES.eligibility.admin.weightFail; eNotes.push('Admin org appears in mainland China — ineligible.'); }
        } else {
          if (ban.includes(orgLoc)){ elig -= RULES.eligibility.admin.weightFail; eNotes.push('Admin org in restricted location (India or mainland China).'); }
          else if (!allow.includes(orgLoc)){ eNotes.push('Admin org location unclear — ECA typically UK/ROI/LMICs.'); }
        }

        // Explicit mention of fund transfer into China
        if (inferred.transferToChina){
          elig -= RULES.eligibility.transferBanChina.weightFail;
          eNotes.push('Transfer of grant funds into mainland China — ineligible.');
        }

        // Co‑applicants
        if (coapps === 'unknown'){
          need.push('Co‑applicants (ECA)');
          if (inferred.coApplicantsLikely){ elig -= RULES.eligibility.coApplicants.weightFail; eNotes.push('Text suggests co‑applicants/consortium — ECA is for a single lead applicant.'); }
        } else if (coapps === 'yes'){
          elig -= RULES.eligibility.coApplicants.weightFail;
          eNotes.push('Co‑applicants are not accepted for the Early‑Career Award.');
        }

        if (need.length && elig > 0) eNotes.unshift(`Eligibility is provisional — please provide: ${need.join(', ')}.`);
        elig = clamp(elig);

        // === Remit
        let remit = RULES.remit.base;
        const rNotes = [];
        const lower = s.toLowerCase();

        for (const p of RULES.remit.positives){
          if (lower.includes(p.p)) { remit += p.w; rNotes.push(`Positive remit cue: “${escapeHtml(p.p)}”.`); }
        }
        const negHitList = [];
        for (const n of RULES.remit.negatives){
          if (lower.includes(n.n)) { remit += n.w; negHitList.push(n); rNotes.push(`Out‑of‑remit cue: “${escapeHtml(n.n)}”${n.why?` — ${escapeHtml(n.why)}`:''}.`); }
        }
        // soften if clearly mechanistic / PoC framing
        if (negHitList.length && /(mechanism|mechanistic|proof[- ]of[- ]concept)/i.test(s)){
          remit += 6; rNotes.push('Mechanistic/PoC framing detected — softened remit penalty.');
        }
        remit = clamp(remit);

        // === Assessment heuristics
        const len = s.split(/\s+/).filter(Boolean).length;
        const hasAims    = /(aim|objective|we propose|we will)/i.test(s);
        const hasMethods = /(method|approach|data|model|experiment|fieldwork|analysis|sample|cohort|interview|ethnograph|survey)/i.test(s);
        const hasRisks   = /(risk|limitation|challenge|mitigat)/i.test(s);
        const hasTeam    = /(mentor|sponsor|collaborat|training|skills|develop)/i.test(s);
        const hasEnv     = /(environment|host|facilit(y|ies)|infrastructure|culture|inclusive|open|data sharing)/i.test(s);
        const novelty    = /(novel|first|innovative|creative|new|advance)/i.test(s);

        let prop=10; prop+=hasAims?25:0; prop+=hasMethods?25:0; prop+=novelty?15:0; prop+=hasRisks?15:0; prop+=(len>200?10:0); prop=Math.min(100,prop);
        let skills=10; skills+=hasTeam?40:0; skills+=(!isFinite(postdocYears)||postdocYears<=3?10:5); skills+=(training!=='none'&&training!=='unknown'?20:0); skills=Math.min(100,skills);
        let env=10; env+=hasEnv?60:0; env=Math.min(100,env);

        // === Render
        results.classList.remove('hidden');
        $('eligScore').textContent  = Math.round(elig);
        $('eligReasons').innerHTML  = list(unique(eNotes), false);
        $('remitScore').textContent = Math.round(remit);
        $('remitReasons').innerHTML = list(unique(rNotes), false);

        $('propProg').value = prop; $('skillsProg').value = skills; $('envProg').value = env;
        $('assessNotes').innerHTML =
          `<li>Proposal ~${len} words; heuristic quality score ${Math.round(prop)}.</li>`+
          `<li>Skills/experience proxy ${Math.round(skills)}; Environment proxy ${Math.round(env)}.</li>`;

        const strengths=[], risks=[];
        if(novelty) strengths.push('Signals of novelty/creativity are present.');
        if(hasMethods) strengths.push('Methods/approach described.');
        if(hasRisks) strengths.push('Risks/mitigations acknowledged.');
        if(hasTeam) strengths.push('Development/training/collaboration elements referenced.');
        if(hasEnv) strengths.push('Positive research environment and culture cues.');
        if(!hasAims)   risks.push('Make the aims/objectives explicit and succinct.');
        if(!hasMethods) risks.push('Describe the methodology and why it’s the right approach.');
        if(!hasRisks)  risks.push('Add key risks/uncertainties and mitigations.');
        if(remit<70)   risks.push('Reframe to emphasise discovery‑led understanding/mechanism.');
        if(elig<70)    risks.push('Address eligibility gaps (training, time commitment, co‑applicants, admin org).');

        $('strengths').innerHTML = list(strengths,true);
        $('risks').innerHTML     = list(risks,true);

        const sugg=[];
        if(!hasAims)    sugg.push('Open with a <strong>bold, discovery‑led question</strong> and 2–3 concise aims.');
        if(!hasMethods) sugg.push('Outline key <strong>methods/approach</strong> and why they best answer the question.');
        if(!/insight|understanding|mechanism/i.test(s)) sugg.push('State the <strong>new knowledge/insight</strong> expected and how it shifts understanding.');
        if(!hasRisks)   sugg.push('List <strong>main risks/uncertainties</strong> and brief mitigations.');
        if(!hasTeam)    sugg.push('Mention <strong>training/skills development</strong> and any collaborators’ roles.');
        if(!hasEnv)     sugg.push('Reference your <strong>research environment</strong> and an <strong>inclusive, open culture</strong>.');
        if(/(randomi[sz]ed|phase\s?(I{1,3}|iv|2|3)\b|trial|efficacy|diagnostic|screening)/i.test(s))
          sugg.push('If any trial/diagnostic elements exist, position them to probe <strong>mechanism</strong> or early <strong>proof‑of‑concept</strong> within a discovery‑led programme.');
        $('suggestions').innerHTML = sugg.length ? sugg.map(x=>`<li>${x}</li>`).join('') : '<li>Looks good. Consider minor tightening for clarity.</li>';

        results.scrollIntoView({behavior:'smooth', block:'start'});
      } catch (e){
        console.error(e);
        toast('Something went wrong while analysing. See console for details.');
      } finally {
        analyzeBtn.disabled = false; analyzeBtn.textContent = prev;
      }
    }

    // helpers
    function parseMaybeFloat(v){ const n = parseFloat(v); return Number.isFinite(n)?n:NaN; }
    function clamp(n){ return Math.max(0, Math.min(100,n)); }
    function unique(arr){ return [...new Set(arr)]; }
    function list(arr, allowEmpty){ if(!arr || !arr.length) return allowEmpty?'<li>—</li>':'<li>No major issues detected.</li>'; return arr.map(s=>`<li>${escapeHtml(s)}</li>`).join(''); }
    function escapeHtml(str){ const map={"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}; return String(str).replace(/[&<>"']/g, ch => map[ch]); }
    function toast(msg){ const t=$('toast'); t.textContent=msg; t.style.display='block'; clearTimeout(t._h); t._h=setTimeout(()=>t.style.display='none', 2500); }

    function inferFromText(text){
      const timeMatch = text.match(/\b([1-9]\d)\s*%(\s*(fte|time|effort))?\b/i);
      const timeUnder80 = !!(timeMatch && parseInt(timeMatch[1],10) < 80);
      return {
        coApplicantsLikely: /(co[-\s]?applicant|co[-\s]?investigator|co[-\s]?pi|consortium|multi[-\s]centre|multi[-\s]center|team of (investigators|applicants))/i.test(text),
        adminIndia: /\b(administer|host|affiliat\w*)\b/i.test(text) && /\bindia\b/i.test(text),
        adminChina: /\b(administer|host|affiliat\w*|transfer)\b/i.test(text) && /\b(mainland china|people'?s republic of china|prc)\b/i.test(text),
        transferToChina: /\btransfer( of)? (grant )?funds (to|into) (mainland )?china\b/i.test(text),
        postdocOver3: /\b(postdoc(toral)? (experience )?(over|more than|> ?)?3 (years|yrs))\b/i.test(text),
        timeUnder80
      };
    }
  </script>
          app.js</script>
</body>
</html>
